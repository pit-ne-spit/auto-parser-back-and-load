# Руководство по итеративному обогащению словаря переводов

## Быстрый старт

Для **полностью автоматического** обогащения словаря переводов используйте итеративный процесс:

```bash
python scripts/iterative_translation_enrichment.py
```

**Важно:** Скрипт автоматически переводит все непереведенные значения через Google Translate API (бесплатно) и добавляет их в словарь. Ручной ввод не требуется!

## Как это работает

### Цикл итерации (полностью автоматический):

1. **Нормализация** - Обрабатывает все записи где `is_processed = false`
2. **Анализ** - Находит все непереведенные китайские значения
3. **Извлечение** - Сохраняет непереведенные значения в `translations_to_add.json`
4. **Автоматический перевод** - Переводит все значения через Google Translate API
5. **Добавление** - Переводы автоматически добавляются в словарь `translator.py`
6. **Сброс** - Устанавливает `is_processed = false` для всех записей
7. **Повтор** - Цикл повторяется до тех пор, пока не останется непереведенных значений

### Пример работы:

```
ИТЕРАЦИЯ 1/10
[ШАГ 1] Нормализация всех объявлений...
✓ Нормализация завершена

[ШАГ 2] Анализ непереведенных значений...
✓ Анализ завершен

[ШАГ 3] Извлечение непереведенных значений...
✓ Извлечение завершено

Найдено непереведенных значений: 500

[ШАГ 4] Автоматический перевод непереведенных значений...
Используется провайдер перевода: google
Обработка поля: mark (50 значений)
  Переведено: 10/500
  Переведено: 20/500
...
✓ Автоматический перевод завершен

[ШАГ 5] Добавление переводов в словарь...
✓ Переводы добавлены в словарь

[ШАГ 6] Сброс флага is_processed для повторной нормализации...
✓ Флаг is_processed сброшен

Проверка количества записей с непереведенными значениями...
Записей с непереведенными значениями: 200

ИТЕРАЦИЯ 2/10
...
```

## Установка зависимостей

Перед использованием установите библиотеку для автоматического перевода:

```bash
pip install googletrans==4.0.0rc1
```

Или установите все зависимости:

```bash
pip install -r requirements.txt
```

## Автоматический перевод

Скрипт автоматически переводит все непереведенные значения через Google Translate API (бесплатно). 

### Альтернативные провайдеры

Вы можете использовать другие провайдеры перевода:

**DeepL API (платный, но очень качественный):**
```bash
export DEEPL_TRANSLATE_API_KEY="your-api-key"
python scripts/iterative_translation_enrichment.py --translation-provider deepl
```

**Yandex Translate API (платный):**
```bash
export YANDEX_TRANSLATE_API_KEY="your-api-key"
python scripts/iterative_translation_enrichment.py --translation-provider yandex
```

## Формат файла переводов (для ручного редактирования)

Если вы хотите вручную отредактировать переводы, откройте `translations_to_add.json` и добавьте переводы в одном из форматов:

### Формат 1: Структурированный (рекомендуется)

```json
{
  "translations_by_field": {
    "mark": {
      "大通": {"translation": "Maxus"},
      "智界": {"translation": "Zhijie"}
    },
    "options": {
      "车联网": {"translation": "Интернет в автомобиле"},
      "OTA升级": {"translation": "OTA обновление"}
    }
  }
}
```

### Формат 2: Простой

```json
{
  "大通": "Maxus",
  "智界": "Zhijie",
  "车联网": "Интернет в автомобиле",
  "OTA升级": "OTA обновление"
}
```

## Параметры запуска

### Базовый запуск (полностью автоматический)

```bash
python scripts/iterative_translation_enrichment.py
```

### Без автоматического перевода (если переводы уже в файле)

```bash
python scripts/iterative_translation_enrichment.py --no-auto-translate --auto-add
```

### С ожиданием ручного редактирования переводов

```bash
python scripts/iterative_translation_enrichment.py --wait
```

### Ограничение итераций

```bash
python scripts/iterative_translation_enrichment.py --max-iterations 5
```

### Минимальное количество вхождений

```bash
python scripts/iterative_translation_enrichment.py --min-count 5
```

Это покажет только те значения, которые встречаются минимум 5 раз.

## Рекомендации

1. **Начните с высокоприоритетных значений** - марки, модели, опции (они помечены как `"priority": "high"`)

2. **Используйте внешние переводчики** - Google Translate, DeepL для быстрого перевода

3. **Проверяйте контекст** - некоторые значения могут иметь разные переводы в зависимости от контекста

4. **Сохраняйте файл** - перед нажатием Enter убедитесь, что файл сохранен

5. **Проверяйте результаты** - после каждой итерации проверяйте файл `untranslated_analysis.txt`

## Автоматизация

Если у вас есть готовый файл с переводами, можно запустить полностью автоматический процесс:

```bash
python scripts/iterative_translation_enrichment.py --auto-add --no-wait --max-iterations 20
```

Это будет автоматически добавлять переводы и повторять цикл без остановок.

## Остановка процесса

Для остановки процесса нажмите `Ctrl+C`. Процесс безопасно остановится, и вы сможете продолжить позже.

## Проверка прогресса

После каждой итерации проверяйте:
- `translations_to_add.json` - сколько осталось непереведенных значений
- `untranslated_analysis.txt` - детальный анализ непереведенных значений

## Когда процесс завершится

Процесс автоматически завершится когда:
- Не останется непереведенных значений
- Будет достигнуто максимальное количество итераций

В конце вы увидите сообщение:
```
✓ ВСЕ ЗНАЧЕНИЯ ПЕРЕВЕДЕНЫ!
```
