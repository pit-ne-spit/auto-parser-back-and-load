# Документация API CHE168.COM

## Общая информация

**Базовый URL:** `https://{access_name}.auto-parser.ru/api/v2/che168`

**Авторизация:** параметр `api_key` в URL или заголовок `x-api-key`

**Платформа:** CHE168.COM - китайская площадка по продаже автомобилей

## Порядок работы с API

1. `/filters` - получить доступные значения фильтров
2. `/offers` - получить объявления (для первоначальной загрузки данных)
3. Для обновлений данных:
   - `/change_id?date=...` - получить начальный ID для ленты изменений
   - `/changes?change_id=...` - получить все изменения начиная с указанного ID
4. `/offer` - получить детали конкретного объявления по inner_id

## Использование API

1. **Импорт данных:** скачайте полный каталог объявлений через `/offers`, перебирая все страницы
2. **Обновление базы:** регулярно запрашивайте `/changes` для получения новых, обновленных и снятых объявлений
3. **Отображение на сайте:** для встраивания данных можно использовать `/offers` с параметрами фильтрации и постраничной навигацией

---

## Эндпоинты API v2

### GET /filters

Возвращает все возможные значения для фильтрации объявлений.

**URL:** `https://{access_name}.auto-parser.ru/api/v2/che168/filters`

**Параметры:**
- `api_key` (обязательный) - ключ API

**Пример запроса:**
```
https://{access_name}.auto-parser.ru/api/v2/che168/filters?api_key=YOUR_API_KEY
```

**Пример ответа:**
```json
{
  "mark": {
    "BMW": {
      "model": ["X5", "X3", "3 серии"]
    },
    "Audi": {
      "model": ["A4", "A6", "Q7"]
    }
  },
  "transmission_type": ["Автоматическая", "Механическая"],
  "color": ["Белый", "Другой", "Желтый", "Зеленый", "Коричневый", "Красный", "Оранжевый", "Серебристо-серый", "Синий", "Темно-серый", "Фиолетовый", "Черный", "Шампань"],
  "body_type": ["Кроссовер/внедорожник", "Купе/родстер", "Легкий грузовик", "Микроавтобус", "Минивэн", "Пикап", "Седан", "Седан/хэтчбек", "Фургон", "Хэтчбек"],
  "engine_type": ["Бензиновый", "Бензиновый + 24V mild hybrid", "Бензиновый + 48V mild hybrid", "Бензиновый + 90V mild hybrid", "Бензиновый + CNG", "Бензиновый + природный газ", "Бензиновый с электроприводом", "Гибридный (HEV)", "Дизельный", "Дизельный + 48V mild hybrid", "Подключаемый гибрид (PHEV)", "Расширитель диапазона (REEV)", "Электрический (BEV)"]
}
```

---

### GET /offers

Список объявлений с пагинацией и фильтрами (регистронезависимые).

**URL:** `https://{access_name}.auto-parser.ru/api/v2/che168/offers`

**Параметры:**
- `api_key` (обязательный) - ключ API
- `page` (обязательный) - номер страницы
- `mark` - марка автомобиля
- `model` - модель автомобиля
- `transmission_type` - тип трансмиссии
- `color` - цвет
- `body_type` - тип кузова
- `engine_type` - тип двигателя
- `year_from` - минимальный год выпуска
- `year_to` - максимальный год выпуска
- `km_age_from` - минимальный пробег (км)
- `km_age_to` - максимальный пробег (км)
- `price_from` - минимальная цена в юанях (CNY)
- `price_to` - максимальная цена в юанях (CNY)

**Примеры запросов:**
```
https://{access_name}.auto-parser.ru/api/v2/che168/offers?api_key=YOUR_API_KEY&page=1
https://{access_name}.auto-parser.ru/api/v2/che168/offers?api_key=YOUR_API_KEY&page=1&mark=BMW&color=черный
```

**Пример ответа:**
```json
{
  "result": [
    {
      "id": 123,
      "inner_id": "53692747",
      "change_type": "added",
      "created_at": "2025-01-15T10:30:00Z",
      "data": {
        "inner_id": "53692747",
        "url": "https://www.che168.com/dealer/527477/53692747.html",
        "mark": "Kia",
        "model": "K2",
        "year": 2013,
        "first_registration": "2013-05",
        "color": "белый",
        "price": 8000,
        "km_age": 110000,
        "engine_type": "бензиновый",
        "transmission_type": "механическая",
        "body_type": "седан",
        "address": "Цзыбо",
        "seller_type": "dealer",
        "is_dealer": true,
        "section": "б/у",
        "salon_id": "527477",
        "description": "杜绝重大事故泡水火烧车...",
        "displacement": 1.4,
        "power": 109,
        "offer_created": "2025-04-29",
        "images": ["https://2sc2.autoimg.cn/..."],
        "configuration": { ... }
      }
    }
  ],
  "meta": {
    "page": 1,
    "next_page": 2,
    "limit": 20
  }
}
```

**Описание полей ответа:**

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | integer | Внутренний ID в базе данных |
| `inner_id` | string | ID объявления на платформе CHE168.COM |
| `change_type` | string | Тип изменения: "added", "changed", "removed" |
| `created_at` | datetime | Дата создания записи |
| `data.inner_id` | string | ID объявления на платформе |
| `data.url` | string | Ссылка на объявление |
| `data.mark` | string | Марка автомобиля |
| `data.model` | string | Модель автомобиля |
| `data.year` | integer | Год выпуска |
| `data.first_registration` | string | Дата первой регистрации (YYYY-MM) |
| `data.color` | string | Цвет |
| `data.price` | integer | Цена в юанях (CNY) |
| `data.km_age` | integer | Пробег в км |
| `data.engine_type` | string | Тип двигателя |
| `data.transmission_type` | string | Тип трансмиссии |
| `data.body_type` | string | Тип кузова |
| `data.address` | string | Адрес продавца |
| `data.seller_type` | string | Тип продавца |
| `data.is_dealer` | boolean | Флаг дилера (true/false) |
| `data.section` | string | Раздел |
| `data.salon_id` | string | ID салона |
| `data.description` | string | Описание |
| `data.displacement` | float | Объем двигателя (л) |
| `data.power` | integer | Мощность двигателя (л.с.) |
| `data.offer_created` | string | Дата создания объявления |
| `data.images` | array | Массив URL изображений |
| `data.configuration` | object | Характеристики авто (JSON) |

**Пример содержимого поля `configuration`:**
```json
{
  "Название модели": "Chery QQ3 2012 Стандарт 1.0L МКПП",
  "Производитель": "Chery",
  "Класс": "микромобиль",
  "Тип топлива": "бензин",
  "Экологический стандарт": "Евро-4+OBD",
  "Дата выхода на рынок": "2012.01",
  "Максимальная мощность (кВт)": "51",
  "Максимальный крутящий момент (Н·м)": "93",
  "Двигатель": "1.0L 69 л.с. L3",
  "Коробка передач": "5-ступенчатая МКПП",
  "Д*Ш*В (мм)": "3550*1495*1530",
  "Тип кузова": "5-дверный 5-местный хэтчбек",
  "Максимальная скорость (км/ч)": "130",
  "Разгон 0-100 км/ч (с)": "-",
  "Гарантия на автомобиль": "3 года или 60000 км",
  "Длина (мм)": "3550",
  "Ширина (мм)": "1495",
  "Высота (мм)": "1530",
  "Колесная база (мм)": "2340",
  "Передняя колея (мм)": "1295",
  "Задняя колея (мм)": "1260",
  "Дорожный просвет (мм)": "152",
  "Количество дверей": "5",
  "Количество мест": "5",
  "Объем топливного бака (л)": "35",
  "Объем багажника (л)": "190",
  "Снаряженная масса (кг)": "890",
  "Модель двигателя": "SQR371F",
  "Рабочий объем (мл)": "998",
  "Рабочий объем (л)": "1.0",
  "Тип наддува": "атмосферный",
  "Расположение цилиндров": "рядное",
  "Количество цилиндров": "3",
  "Клапанов на цилиндр": "4",
  "Степень сжатия": "11",
  "Газораспределительный механизм": "DOHC",
  "Максимальная мощность (л.с.)": "69",
  "Обороты макс. мощности (об/мин)": "6000",
  "Обороты макс. крутящего момента (об/мин)": "3500-4500",
  "Октановое число": "АИ-92",
  "Система питания": "распределенный впрыск",
  "Материал ГБЦ": "алюминиевый сплав",
  "Материал блока цилиндров": "чугун",
  "Количество передач": "5",
  "Тип КПП": "механическая (МКПП)",
  "Тип привода": "передний",
  "Передняя подвеска": "независимая пружинная стойка",
  "Задняя подвеска": "полузависимая, торсионная балка",
  "Усилитель руля": "гидроусилитель",
  "Конструкция кузова": "несущий",
  "Передние тормоза": "дисковые",
  "Задние тормоза": "барабанные",
  "Стояночный тормоз": "ручной",
  "Размерность передних шин": "155/65 R13",
  "Размерность задних шин": "155/65 R13",
  "Запасное колесо": "полноразмерное"
}
```

---

### GET /change_id

Получить первый ID изменения по дате (для использования в `/changes`).

**URL:** `https://{access_name}.auto-parser.ru/api/v2/che168/change_id`

**Параметры:**
- `api_key` (обязательный) - ключ API
- `date` (обязательный) - дата в формате yyyy-mm-dd

**Пример запроса:**
```
https://{access_name}.auto-parser.ru/api/v2/che168/change_id?api_key=YOUR_API_KEY&date=2025-01-15
```

**Пример ответа:**
```json
{
  "change_id": 892145
}
```

**Примечание:** Используйте полученное значение в качестве параметра `change_id` в `/changes`.

---

### GET /changes

Лента изменений (добавленные/измененные/удаленные объявления).

**URL:** `https://{access_name}.auto-parser.ru/api/v2/che168/changes`

**Параметры:**
- `api_key` (обязательный) - ключ API
- `change_id` (обязательный) - начиная с какого ID изменения

**Пример запроса:**
```
https://{access_name}.auto-parser.ru/api/v2/che168/changes?api_key=YOUR_API_KEY&change_id=892145
```

**Пример ответа:**
```json
{
  "result": [
    {
      "id": 892145,
      "inner_id": "53692747",
      "change_type": "added",
      "created_at": "2025-04-29T08:15:22.340+03:00",
      "data": { ... }  // полные данные объявления
    },
    {
      "id": 892146,
      "inner_id": "53692747",
      "change_type": "changed",
      "created_at": "2025-04-30T14:28:11.560+03:00",
      "data": { "new_price": 7500 }  // изменение цены
    },
    {
      "id": 892147,
      "inner_id": "53685231",
      "change_type": "removed",
      "created_at": "2025-04-30T16:42:05.890+03:00",
      "data": {}  // объявление удалено
    }
  ],
  "meta": {
    "cur_change_id": 892145,
    "next_change_id": 892148,
    "limit": 20
  }
}
```

**Описание полей ответа:**

| Поле | Тип | Описание |
|------|-----|----------|
| `result[].id` | integer | ID изменения |
| `result[].inner_id` | string | ID объявления на платформе |
| `result[].change_type` | string | Тип изменения: "added", "changed", "removed" |
| `result[].created_at` | datetime | Дата создания изменения |
| `result[].data` | object | Данные объявления или изменения |
| `meta.cur_change_id` | integer | Текущий ID изменения |
| `meta.next_change_id` | integer | Следующий ID для продолжения запроса |
| `meta.limit` | integer | Лимит записей на странице |

**Типы изменений:**
- `added` - новое объявление (в `data` полные данные объявления)
- `changed` - измененное объявление (в `data` только измененные поля)
- `removed` - удаленное объявление (в `data` пустой объект)

---

### GET /offer

Получить детали конкретного объявления по inner_id.

**URL:** `https://{access_name}.auto-parser.ru/api/v2/che168/offer`

**Параметры:**
- `api_key` (обязательный) - ключ API
- `inner_id` (обязательный) - ID объявления на платформе

**Пример запроса:**
```
https://{access_name}.auto-parser.ru/api/v2/che168/offer?api_key=YOUR_API_KEY&inner_id=53692747
```

**Пример ответа:**
```json
{
  "inner_id": "53692747",
  "url": "https://www.che168.com/dealer/527477/53692747.html",
  "mark": "Kia",
  "model": "K2",
  "year": 2013,
  "first_registration": "2013-05",
  "color": "белый",
  "price": 8000,
  "km_age": 110000,
  "engine_type": "бензиновый",
  "transmission_type": "механическая",
  "body_type": "седан",
  "address": "Цзыбо",
  "seller_type": "dealer",
  "is_dealer": true,
  "section": "б/у",
  "salon_id": "527477",
  "description": "杜绝重大事故泡水火烧车...",
  "displacement": 1.4,
  "power": 109,
  "offer_created": "2025-04-29",
  "images": ["https://2sc2.autoimg.cn/..."],
  "configuration": { ... }
}
```

**Примечание:** Ответ содержит объект `data` (такой же как в `/offers`, но без обертки `result`).

---

## Эндпоинты API v1

### POST /api/v1/offer/info

Получение данных объявления по ссылке с che168.com.

**URL:** `https://{access_name}.auto-parser.ru/api/v1/offer/info`

**Авторизация:** заголовок `x-api-key`

**Параметры запроса (JSON body):**
- `url` (обязательный) - ссылка на объявление с che168.com

**Пример запроса:**
```bash
curl -L 'https://{access_name}.auto-parser.ru/api/v1/offer/info' \
  -H 'x-api-key: YOUR_API_KEY' \
  -H 'Content-Type: application/json' \
  -d '{ "url": "https://www.che168.com/dealer/209189/57100539.html" }'
```

**Пример ответа:**
```json
{
  "car_name": "Honda Accord 2023",
  "url": "https://www.che168.com/dealer/57100539.html",
  "mark": "Honda",
  "model": "Accord",
  "year": 2023,
  "first_registration": "2023-06",
  "color": "белый",
  "price": 158000,
  "km_age": 25000,
  "engine_type": "Бензиновый",
  "transmission_type": "автоматическая",
  "offer_created": "2024-01-15",
  "displacement": 1498,
  "power": 192,
  "vin": "LHGCV2650XXXXXXX",
  "images": [
    "https://2sc2.autoimg.cn/escimg/auto/g32/M08/6A/D4/1024x768_c42_autohomecar__ChxkPWdD5N-Ab4R4AAeBnPwthFA323.jpg.webp",
    "https://2sc2.autoimg.cn/escimg/auto/g32/M0A/6A/D4/1024x768_c42_autohomecar__ChxkPWdD5OCAUWKqAAdTmCyM0G4153.jpg.webp"
  ]
}
```

**Описание полей ответа:**

| Поле | Тип | Описание |
|------|-----|----------|
| `car_name` | string | Название автомобиля |
| `url` | string | Ссылка на объявление |
| `mark` | string | Марка автомобиля |
| `model` | string | Модель автомобиля |
| `year` | integer | Год выпуска |
| `first_registration` | string | Дата первой регистрации (YYYY-MM) |
| `color` | string | Цвет |
| `price` | integer | Цена в юанях (CNY) |
| `km_age` | integer | Пробег в км |
| `engine_type` | string | Тип двигателя |
| `transmission_type` | string | Тип трансмиссии |
| `offer_created` | string | Дата создания объявления |
| `displacement` | integer | Объем двигателя (мл) |
| `power` | integer | Мощность двигателя (л.с.) |
| `vin` | string | VIN-номер автомобиля |
| `images` | array | Массив URL изображений |

---

## Ежедневные выгрузки

### Общая информация

Вы получаете адрес, логин и пароль к персональным выгрузкам.

**Параметры выгрузок:**
- **Хранение:** минимум 3 суток на сервере
- **Обновление:** ежедневно после 08:00 МСК
- **Формат:** CSV с разделителем `|`

**Ссылка на скачивание выгрузки:**
```
https://{access_name}.auto-parser.ru/{date}/{file_name}
```

**Примечание:** По API можно получать информацию о новых объявлениях, опубликованных на che168.com.

---

## Какие данные предоставляет парсер

Парсер ежедневно выгружает:
- Все активные автообъявления
- Проданные авто за предыдущие сутки

В режиме мониторинга парсер отслеживает новые объявления, информация о которых будет доступна по API.

Парсер собирает следующие данные об авто:
- Цена
- Марка
- Модель
- Год выпуска
- Пробег
- Тип трансмиссии
- Тип кузова
- Описание
- Объем двигателя
- VIN
- Изменение цены
- И другие характеристики

В полной версии выгрузки предоставляются:
- Список опций авто
- VIN номер
- Информация об авариях
- Отчет предпродажной диагностики

---

## Варианты использования данных

1. **Ежедневные выгрузки:**
   - Все активные объявления - представление о текущем рынке авто
   - Снятые автомобили - понимание спроса, цены продажи и срока экспозиции
   - Расчет медианной и средней цены для каждого автомобиля

2. **Данные в реальном времени:**
   - Отслеживание новых объявлений по нужным фильтрам
   - Мониторинг изменений цен
   - Отслеживание снятых объявлений

3. **Аналитика:**
   - Анализ автомобильного рынка Китая
   - Мониторинг ценовых трендов
   - Изучение популярности моделей

---

## Контакты

- **Telegram:** @autoparser
- **Email:** info@auto-parser.ru
- **Сайт:** https://auto-parser.ru

---

*Документация актуальна на февраль 2026 года*
